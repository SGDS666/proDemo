"use strict";(self.webpackChunklaifaxin_web=self.webpackChunklaifaxin_web||[]).push([[3105],{88208:function(ge,le,a){var ce=a(30279),s=a.n(ce),fe=a(85170),u=a(91522),d=a(43010);le.Z=function(I){var U=I.children,G=I.pageTitle;return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(u._z,s()(s()({header:{title:G,breadcrumb:{}}},I),{},{children:U}))})}},12653:function(ge,le,a){a.d(le,{Z:function(){return de}});var ce=a(30279),s=a.n(ce),fe=a(35290),u=a.n(fe),d=a(94434),I=a.n(d),U=a(411),G=a.n(U),X=a(46686),Y=a.n(X),z=a(85170),L=a(31810),re=a(41318),me=a(2800),A=a(96498),x=a(46394),p=a(43520),_=a(58110),y=a(1166),C=a(36236),V=a(25106),oe=a(28931),B=a(78511),se={"field-item":"field-item___DE1sS"},M=a(22196),i=a(43010),$=function(k){var P=k.visible,W=k.onCancel,v=k.insertAction,D=(0,y.Z)({contactOptions:[],companyOptions:[],options:[],fieldType:"contact",key:""}),g=Y()(D,2),l=g[0],S=g[1],N=(0,M.useRequest)(B.Bq,{manual:!0,onSuccess:function(b){S({contactOptions:b,options:b})}}),H=N.run,ne=(0,M.useRequest)(B.b6,{manual:!0,onSuccess:function(b){S({companyOptions:I()(b),options:I()(b)})}}),R=ne.run,n=function(){var Z=G()(u()().mark(function b(ae){var K,J;return u()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:K=l.contactOptions,J=l.companyOptions,ae==="contact"?K&&K.length?S({options:I()(K)}):H():J&&J.length?S({options:I()(J)}):R();case 2:case"end":return he.stop()}},b)}));return function(ae){return Z.apply(this,arguments)}}(),r=function(b,ae){var K=l.fieldType;v({fieldType:K,dataIndex:b,title:ae})},t=function(b){var ae=l.key,K=b.dataIndex,J=b.title;if(ae){var ve=J.indexOf(ae);if(ve<0)return null}return(0,i.jsx)("div",{className:se["field-item"],onClick:function(){return r(K,J)},children:J},K)},e=function(b){S({fieldType:b}),n(b)};return(0,z.useEffect)(function(){P&&n("contact")},[P]),(0,i.jsx)(_.Z,{title:"\u63D2\u5165\u53D8\u91CF\u9009\u62E9",width:300,bodyStyle:{height:450},destroyOnClose:!0,open:P,footer:null,onCancel:W,children:(0,i.jsxs)(oe.Z,{direction:"vertical",children:[(0,i.jsxs)(p.Z,{style:{width:"100%"},value:l.fieldType,onChange:e,children:[(0,i.jsx)(p.Z.Option,{value:"contact",children:"\u8054\u7CFB\u4EBA"}),(0,i.jsx)(p.Z.Option,{value:"company",children:"\u516C\u53F8"})]}),(0,i.jsx)(me.Z.Search,{placeholder:"\u641C\u7D22\u5B57\u6BB5",allowClear:!0,onChange:function(b){return S({key:b.target.value})},style:{width:"100%",paddingBottom:10},value:l.key}),(0,i.jsx)("div",{style:{fontSize:16,overflow:"auto",height:300},children:l.options.map(function(Z){return t(Z)})})]})})},q=$,F=a(88665),ie=a(74729),ee=function(k){var P=L.Z.useForm(),W=Y()(P,1),v=W[0],D=k.visible,g=k.action,l=k.current,S=k.onCancel,N=k.actionReload,H=k.folderItems,ne=(0,y.Z)({_id:null,html:"",insertVisible:!1,subjectInsertVisible:!1,filedOptions:[],editor:null,veriables:{},subjectVeriables:{},ver:!1,folderOptions:[]}),R=Y()(ne,2),n=R[0],r=R[1],t=function(){var j=G()(u()().mark(function c(f){var o,T,m;return u()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(f&&f.length)){h.next=4;break}o=I()(f),h.next=7;break;case 4:return h.next=6,(0,ie.Pd)({type:"content"});case 6:o=h.sent;case 7:o&&o[0]&&(T=o[0].foid,T==="all"&&o.splice(0,1)),m=o.map(function(w){return{label:w.name,value:w.foid}}),r({folderOptions:m});case 10:case"end":return h.stop()}},c)}));return function(f){return j.apply(this,arguments)}}();(0,z.useEffect)(function(){if(D){if(t(H),v.resetFields(),g==="add"&&(r({html:"",veriables:{}}),v.setFieldsValue({foid:"0"})),g==="update"){var j=l._id,c=l.name,f=l.subject,o=l.html,T=l.veriables,m=l.foid;v.setFieldsValue({_id:j,name:c,subject:f,foid:m}),r(T?{html:o,veriables:T}:{html:o,veriables:{}})}if(g==="copy"){var O=l.name,h=l.subject,w=l.html,Q=l.veriables,pe=l.foid;v.setFieldsValue({name:"".concat(O,".\u526F\u672C"),subject:h,foid:pe}),r(Q?{html:w,veriables:Q}:{html:w,veriables:{}})}}},[D]);var e=(0,M.useRequest)(ie.m$,{manual:!0,onSuccess:function(){re.ZP.success("".concat(l?"\u4FDD\u5B58":"\u65B0\u589E","\u90AE\u4EF6\u6A21\u677F\u6210\u529F\uFF01")),S(),N()}}),Z=e.run,b=e.loading,ae=function(){var j=G()(u()().mark(function c(){var f,o,T,m,O,h,w,Q,pe,be,ue,ye;return u()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(v){E.next=2;break}return E.abrupt("return");case 2:return v.submit(),E.prev=3,E.next=6,v.validateFields();case 6:if(f=E.sent,o=n.html,T=n.veriables,m=n.subjectVeriables,console.log(m),!(!o||!o.length)){E.next=12;break}return re.ZP.error("\u90AE\u4EF6\u6B63\u6587\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),E.abrupt("return");case 12:O=f.subject,h=(0,F.MZ)(o,T),w=Y()(h,2),Q=w[0],pe=w[1],be=(0,F.MZ)(O,m),ue=Y()(be,2),ye=ue[1],Z(s()(s()({},f),{},{html:o,ver:Q,veriables:pe,subjectVeriables:ye})),E.next=21;break;case 18:E.prev=18,E.t0=E.catch(3),console.log("Failed:",E.t0);case 21:case"end":return E.stop()}},c,null,[[3,18]])}));return function(){return j.apply(this,arguments)}}(),K={okText:"\u4FDD\u5B58",onOk:ae,onCancel:S},J=function(c){var f=c.fieldType,o=c.dataIndex,T=c.title,m="\u8054\u7CFB\u4EBA";f==="company"&&(m="\u516C\u53F8");var O=n.editor,h=n.veriables,w='<code class="lfxFieldVeriable" contenteditable="false">{'.concat(m,":").concat(T,"}</code>");h["".concat(m,":").concat(o)]={code:w,fieldType:f,fieldTbl:m,dataIndex:o,title:T},O.insertContent(w),r({insertVisible:!1,veriables:h,ver:!0})},ve=function(c){var f=c.fieldType,o=c.dataIndex,T=c.title,m="\u8054\u7CFB\u4EBA";f==="company"&&(m="\u516C\u53F8");var O="{".concat(m,":").concat(T,"}"),h=n.subjectVeriables;h["".concat(m,":").concat(o)]={code:O,fieldType:f,fieldTbl:m,dataIndex:o,title:T};var w=v.getFieldValue("subject"),Q=w?"".concat(w).concat(O):O;v.setFieldsValue({subject:Q}),r({subjectVeriables:h,subjectInsertVisible:!1})},he=function(c){r({html:c})},Ce=function(){var j=G()(u()().mark(function c(f,o,T){var m,O,h,w,Q,pe;return u()().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return m=f.blob(),ue.next=3,(0,V.c)(m,"img",!0);case 3:O=ue.sent,h=O.success,w=O.data,Q=O.error,h?(pe=w.url,o(pe)):T(Q);case 6:case"end":return ue.stop()}},c)}));return function(f,o,T){return j.apply(this,arguments)}}(),Fe=function(c){c.ui.registry.addButton("customInsertButton",{text:"\u63D2\u5165\u53D8\u91CF",tooltip:"\u63D2\u5165\u53D8\u91CF",onAction:function(){r({insertVisible:!0,editor:c})}})},Se=function(){var c=Promise,f=n.html;return f?c.resolve():c.reject("\u90AE\u4EF6\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A")},we=function(){return(0,i.jsxs)(L.Z,{form:v,layout:"vertical",children:[(0,i.jsx)(L.Z.Item,{hidden:!0,name:"_id",label:"\u4FDD\u5B58id",children:(0,i.jsx)(me.Z,{})}),(0,i.jsxs)(A.Z,{children:[(0,i.jsx)(x.Z,{span:12,style:{paddingRight:24},children:(0,i.jsx)(L.Z.Item,{name:"name",label:"\u6A21\u677F\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"}],children:(0,i.jsx)(me.Z,{placeholder:"\u9488\u5BF9\u90AE\u4EF6\u5185\u5BB9\u7684\u5907\u6CE8\uFF0C\u4EC5\u60A8\u81EA\u5DF1\u53EF\u89C1"})})}),(0,i.jsx)(x.Z,{span:12,children:(0,i.jsx)(L.Z.Item,{name:"foid",label:"\u4FDD\u5B58\u5206\u7EC4",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4FDD\u5B58\u5206\u7EC4"}],children:(0,i.jsx)(p.Z,{options:n.folderOptions})})})]}),(0,i.jsx)(L.Z.Item,{name:"subject",label:"\u6A21\u677F\u4E3B\u9898",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u4EF6\u4E3B\u9898"}],tooltip:"\u90AE\u4EF6\u4E3B\u9898",children:(0,i.jsx)(me.Z,{placeholder:"\u90AE\u4EF6\u4E3B\u9898",addonAfter:(0,i.jsx)("a",{onClick:function(){return r({subjectInsertVisible:!0})},children:"\u63D2\u5165\u53D8\u91CF"})})}),(0,i.jsx)(L.Z.Item,{name:"content",label:"\u6A21\u677F\u6B63\u6587",rules:[{required:!0,validator:Se}],tooltip:"\u90AE\u4EF6\u6B63\u6587\u5185\u5BB9\uFF0C\u53EF\u63D2\u5165\u53D8\u91CF",children:(0,i.jsx)("div",{children:(0,i.jsx)(C.M,{value:n.html,tinymceScriptSrc:"/lstatic/libs/tinymce/5.5.1/tinymce.min.js",init:{auto_focus:!0,height:500,menubar:!0,language:"zh_CN",plugins:"print preview searchreplace autolink directionality visualblocks visualchars fullscreen image link media template code codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern help paste emoticons autosave",toolbar:"undo redo | formatselect fontselect fontsizeselect |                   forecolor backcolor bold italic underline strikethrough |                   alignleft aligncenter alignright alignjustify outdent indent | bullist numlist |                   customInsertButton",fontsize_formats:"8px 9px 10px 11px 12px 14px 16px 18px 24px 36px 48px 56px 72px",images_upload_handler:Ce,setup:Fe},onEditorChange:he})})})]})};return(0,i.jsxs)(_.Z,s()(s()({title:"".concat(l?"\u7F16\u8F91":"\u65B0\u589E","\u90AE\u4EF6\u6A21\u677F"),width:"1230px",bodyStyle:{padding:"24px 24px 24px"},destroyOnClose:!0,open:D,maskClosable:!1,confirmLoading:b},K),{},{children:[we(),(0,i.jsx)(q,{visible:n.insertVisible,onCancel:function(){return r({insertVisible:!1})},insertAction:J}),(0,i.jsx)(q,{visible:n.subjectInsertVisible,onCancel:function(){return r({subjectInsertVisible:!1})},insertAction:ve})]}))},de=ee},78511:function(ge,le,a){a.d(le,{Bq:function(){return q},JA:function(){return W},L6:function(){return se},Mc:function(){return C},Mt:function(){return N},Q0:function(){return k},SO:function(){return i},UL:function(){return D},b6:function(){return ie},p1:function(){return x},s6:function(){return de},sD:function(){return l},sz:function(){return ne},y2:function(){return Y},zN:function(){return G}});var ce=a(35290),s=a.n(ce),fe=a(411),u=a.n(fe),d=a(22196);function I(){return U.apply(this,arguments)}function U(){return U=_asyncToGenerator(_regeneratorRuntime().mark(function n(){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/fields/contact-table-columns",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),U.apply(this,arguments)}function G(){return X.apply(this,arguments)}function X(){return X=u()(s()().mark(function n(){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/fields/contact-table-Fields",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),X.apply(this,arguments)}function Y(){return z.apply(this,arguments)}function z(){return z=u()(s()().mark(function n(){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/fields/contact-tags-field",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),z.apply(this,arguments)}function L(){return re.apply(this,arguments)}function re(){return re=_asyncToGenerator(_regeneratorRuntime().mark(function n(){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/fields/contact-show-columns",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),re.apply(this,arguments)}function me(){return A.apply(this,arguments)}function A(){return A=_asyncToGenerator(_regeneratorRuntime().mark(function n(){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/fields/contact-create-columns",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),A.apply(this,arguments)}function x(){return p.apply(this,arguments)}function p(){return p=u()(s()().mark(function n(){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/fields/contact-create-fields",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),p.apply(this,arguments)}function _(){return y.apply(this,arguments)}function y(){return y=_asyncToGenerator(_regeneratorRuntime().mark(function n(){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/fields/contact-update-columns",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),y.apply(this,arguments)}function C(){return V.apply(this,arguments)}function V(){return V=u()(s()().mark(function n(){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/fields/contact-update-fields",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),V.apply(this,arguments)}function oe(){return B.apply(this,arguments)}function B(){return B=_asyncToGenerator(_regeneratorRuntime().mark(function n(){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/fields/contact-filter-columns",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),B.apply(this,arguments)}function se(){return M.apply(this,arguments)}function M(){return M=u()(s()().mark(function n(){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/fields/contact-filter-fields",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),M.apply(this,arguments)}function i(){return $.apply(this,arguments)}function $(){return $=u()(s()().mark(function n(){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/fields/contact-import-fields",{method:"POST"}));case 1:case"end":return t.stop()}},n)})),$.apply(this,arguments)}function q(){return F.apply(this,arguments)}function F(){return F=u()(s()().mark(function n(){var r;return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={belongTo:"contact",saveType:"read"},e.abrupt("return",(0,d.request)("/api/fields/contacts-fields",{method:"POST",data:r}));case 2:case"end":return e.stop()}},n)})),F.apply(this,arguments)}function ie(){return ee.apply(this,arguments)}function ee(){return ee=u()(s()().mark(function n(){var r;return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={belongTo:"company",saveType:"read"},e.abrupt("return",(0,d.request)("/api/fields/company-fields",{method:"POST",data:r}));case 2:case"end":return e.stop()}},n)})),ee.apply(this,arguments)}function de(n){return te.apply(this,arguments)}function te(){return te=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/contacts-fields",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),te.apply(this,arguments)}function k(n){return P.apply(this,arguments)}function P(){return P=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/contacts-columns",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),P.apply(this,arguments)}function W(n){return v.apply(this,arguments)}function v(){return v=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/save-columns-config",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),v.apply(this,arguments)}function D(n){return g.apply(this,arguments)}function g(){return g=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/save-field-config",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),g.apply(this,arguments)}function l(n){return S.apply(this,arguments)}function S(){return S=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/field/create",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),S.apply(this,arguments)}function N(n){return H.apply(this,arguments)}function H(){return H=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/field/update",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),H.apply(this,arguments)}function ne(n){return R.apply(this,arguments)}function R(){return R=u()(s()().mark(function n(r){return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/fields/field/delete",{method:"POST",data:r}));case 1:case"end":return e.stop()}},n)})),R.apply(this,arguments)}},25106:function(ge,le,a){a.d(le,{c:function(){return re}});var ce=a(35290),s=a.n(ce),fe=a(411),u=a.n(fe),d=a(30279),I=a.n(d),U=a(22196);function G(A){return X.apply(this,arguments)}function X(){return X=u()(s()().mark(function A(x){var p;return s()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,U.request)("/api/file/get-auth",{method:"POST",data:I()({},x)});case 2:return p=y.sent,y.abrupt("return",p);case 4:case"end":return y.stop()}},A)})),X.apply(this,arguments)}function Y(A){return z.apply(this,arguments)}function z(){return z=u()(s()().mark(function A(x){var p,_;return s()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,(0,U.request)("/api/file/save-log",{method:"POST",data:I()({},x)});case 2:return p=C.sent,_=p.data,C.abrupt("return",_);case 5:case"end":return C.stop()}},A)})),z.apply(this,arguments)}var L=a(21156),re=function(){var A=u()(s()().mark(function x(p,_,y){var C,V,oe,B,se,M,i,$,q,F,ie,ee,de,te,k,P,W,v,D,g,l,S,N,H,ne,R,n,r;return s()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return C={success:!1,data:{},error:""},e.prev=1,V=p.name,oe=p.type,B=p.size,se=V.split("."),M=Date.now(),i=se[se.length-1].toLowerCase(),e.next=8,G({type:_});case 8:if($=e.sent,q=$.success,F=$.data,ie=$.message,ee=$.status,q){e.next=15;break}return e.abrupt("return",{success:q,error:ie,status:ee});case 15:return de=F.SecurityToken,te=F.AccessKeyId,k=F.AccessKeySecret,P=F.region,W=F.bucket,v=F.uid,D=F.dirName,g=F.id,l=F.webSite,S={timeout:36e4},N="".concat(_,"/").concat(D,"/").concat(g,"_").concat(M,".").concat(i),_==="att"&&(S["Content-Disposition"]="attachment",S["Cache-Control"]="no-cache",N="".concat(_,"/").concat(D,"/").concat(g,"/").concat(V)),H=new L({bucket:W,region:P,accessKeyId:te,accessKeySecret:k,stsToken:de}),e.next=22,H.put(N,p,S);case 22:if(ne=e.sent,R=ne.url,l&&(R="".concat(l,"/").concat(N)),n=ne.name,!y){e.next=32;break}return e.next=29,Y({iid:g,id:g,name:V,url:R,filePath:n,bucket:W,region:P,filename:"".concat(g,".").concat(i),dirName:D,uid:v,fileType:oe,type:_,size:B});case 29:C.data=e.sent,e.next=33;break;case 32:C.data={name:V,url:R,filePath:n,bucket:W,region:P,filename:"".concat(g,".").concat(i),dirName:D,uid:v,fileType:oe,type:_,size:B,iid:g,id:g};case 33:C.success=!0,e.next=40;break;case 36:e.prev=36,e.t0=e.catch(1),r=e.t0.message,C.error=r;case 40:return e.abrupt("return",C);case 41:case"end":return e.stop()}},x,null,[[1,36]])}));return function(p,_,y){return A.apply(this,arguments)}}(),me=null}}]);
